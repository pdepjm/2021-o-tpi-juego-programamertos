import wollok.game.*
import level.*
import levels.*
import players.*
import directions.*
import menu.*
import tile.*
import soundProducer.*

/*method initialize() {
		soundProducer.provider(soundProviderMock)		
	} */

describe "Player's Movements" {
	   const p1 = new Player(
                id = 1,
                color = "purple",
                position = game.at(1,15),
                upBind = keyboard.w(), 
                downBind = keyboard.s(), 
                leftBind = keyboard.a(), 
                rightBind = keyboard.d(),
                bombKey = keyboard.q()
            )

        const p2 = new Player(
            id = 2,
            color = "yellow",
            position = game.at(1,1),
            upBind = keyboard.up(), 
            downBind = keyboard.down(), 
            leftBind = keyboard.left(), 
            rightBind = keyboard.right(),
            bombKey = keyboard.minusKey()
        )
        
        var solidTile = new SolidTile(position = game.at(5 , 1))
         
	test "A Player moves to the right" {
		p1.move(right) 
		assert.equals(game.at(2 , 15) , p1.position())
	}	
	
	
	test "A Player moves to the left" {
		p2.move(right)
		p2.move(right)
		p2.move(left)
		assert.equals(game.at(2 , 1) , p2.position())
	}
	
	test "A Player moves up" {
		p2.move(up)
		p2.move(up)
		assert.equals(game.at(1 , 3) , p2.position())
	}
	
	test "A Player moves down" {
		p1.move(down)
		p1.move(down)
		assert.equals(game.at(1 , 13) , p1.position())
	}
	
	test "A player moves to th right with the bottom 'right'"{
      p1.setup()	 
	  keyboard.right()
	  keyboard.right()
	  keyboard.right()
	  assert.equals(game.at(4 , 15) , p1.position())
	  }
	  
	  test "A player moves to the left with the bottom 'A'"{
	  	p2.setup()
	  	keyboard.d()
	  	keyboard.d()
	  	keyboard.d()
	  	keyboard.a()
	  	assert.equals(game.at(3 , 1) , p2.position())
	  }
	  
	  test "A player moves up with the bottom 'W'"{
	  	p2.setup()
	  	keyboard.w()
	  	keyboard.w()
	  	assert.equals(game.at(1 , 3) , p2.position())
	  }
	  
	  test "A player moves down with the bottom 'down'"{
	  	keyboard.down().onPressDo({p1.setup()})
	  	keyboard.down()
	  	keyboard.down()
	  	assert.equals(game.at(1 , 13) , p1.position())
	  } 
	  
	  test "A player cannot pass a wall" {
	  	4.times({p2.move(right)})
	  	assert.equals(game.at(4 , 1) , p2.position())
	  }
}

describe "Player's Habilities"{
	 const p1 = new Player(
                id = 1,
                color = "purple",
                position = game.at(1,15),
                upBind = keyboard.w(), 
                downBind = keyboard.s(), 
                leftBind = keyboard.a(), 
                rightBind = keyboard.d(),
                bombKey = keyboard.q()
            )
      
      var destroyableTile = new DestroyableTile(position = game.at(3 , 15))
            
      test "Player drop a Bomb" {
         p1.move(right)
         p1.dropBomb()
         assert.that(not(game.hasVisual(destroyableTile)))
      }
      
      test "Drop a Bomb with the bottom 'Q'"{
      	p1.setup()
      	destroyableTile.render()
      	keyboard.right()
      	keyboard.q()
      	assert.that(not(game.hasVisual(destroyableTile)))
      }
}

describe "Player's Interactions" {
	 const p1 = new Player(
                id = 1,
                color = "purple",
                position = game.at(1,15),
                upBind = keyboard.w(), 
                downBind = keyboard.s(), 
                leftBind = keyboard.a(), 
                rightBind = keyboard.d(),
                bombKey = keyboard.q()
            )
      
      test "A player dies when drop a Bomb"{
      	p1.dropBomb()
      	assert.that(not(game.hasVisual(p1)))
      }
      
      test "A player dies when expansion is incoming"{
      	4.times(p1.move(down))
      	game.schedule(500 , p1.dropBomb())
      	game.schedule(500 * 1.1 , 3.times(p1.move(up)))
      	assert.that(not(game.hasVisual(p1)))
      }
}
